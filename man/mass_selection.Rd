% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/namesame.R
\name{mass_selection}
\alias{mass_selection}
\title{Untargeted Metabolomics Feature Selection (MS)}
\usage{
mass_selection(
  ms_mat,
  sample_meta,
  group_var,
  batch_var = NULL,
  qc_flag_var = NULL,
  prevalence_threshold = 0.7,
  impute_method = c("halfmin", "knn"),
  normalize_method = c("median", "TIC", "quantile"),
  combat = TRUE,
  qc_drift_correction = TRUE,
  qc_rsd_cut = 0.3,
  diff_method = c("limma", "wilcoxon"),
  ml_method = c("rf", "gbm", "boruta"),
  cor_method = c("spearman", "pearson"),
  cor_threshold = 0.6,
  p_threshold = 0.05,
  weights = list(abundance = 0.3, importance = 0.3, differential = 0.2, network = 0.2),
  nfolds = 5,
  ntree = 500
)
}
\arguments{
\item{ms_mat}{矩阵/数据框：样本×代谢物（intensity），行名=样本名，列名=代谢物ID}

\item{sample_meta}{数据框：包含分组/批次/QC 标识，行名=样本名}

\item{group_var}{分组变量名（在 sample_meta 中）}

\item{batch_var}{批次变量名（可选，用于ComBat）}

\item{qc_flag_var}{QC 标识变量名（TRUE/FALSE 或 0/1），用于漂移校正/稳定性过滤}

\item{prevalence_threshold}{特征保留的样本占比阈值（默认0.7）}

\item{impute_method}{缺失值填补：'halfmin'|'knn'（默认'halfmin'）}

\item{normalize_method}{强度归一化：'TIC'|'median'|'quantile'（默认'median'）}

\item{combat}{是否执行 ComBat 批次校正（默认 TRUE）}

\item{qc_drift_correction}{是否执行 QC-based 漂移校正（默认 TRUE）}

\item{qc_rsd_cut}{基于 QC 的 RSD 过滤阈值（默认0.3）}

\item{diff_method}{差异分析方法：'limma'|'wilcoxon'（默认 'limma'）}

\item{ml_method}{ML 方法：'rf'|'gbm'|'boruta'（默认 'rf'）}

\item{cor_method}{相关：'spearman'|'pearson'（默认 'spearman'）}

\item{cor_threshold}{边阈值（默认 0.6）}

\item{p_threshold}{相关 p 值阈值（默认 0.05）}

\item{weights}{综合权重 list(abundance, importance, differential, network)}

\item{nfolds}{ML 交叉验证折数（默认 5）}

\item{ntree}{RF 森林数（默认 500）}
}
\value{
list: final_ranking / full_results / diff_results / importance_results /
  network_results / abundance_results / processed_ms（处理后矩阵）/ parameters
\dontrun{
tab = ps.ms %>%subset_samples.wt("Group",c("WT","KO")) %>% vegan_otu( ) %>%
 as.data.frame()
map = sample_data(ps.ms %>%subset_samples.wt("Group",c("WT","KO")) )
map$Group = as.factor(map$Group)
map$ID = NULL
res <- mass_selection(
 ms_mat         = tab,
 sample_meta    = map,
 group_var      = "Group",
batch_var      = NULL,
 qc_flag_var    = NULL,
 prevalence_threshold = 0.7,      # ≥70% 样本非缺失才保留
 impute_method  = "halfmin",      # 缺失填补：半最小值
 normalize_method = "median",     # 归一化：样本中位数
 combat         = F,           # 批次校正：ComBat
qc_drift_correction = TRUE,      # 用 QC 做 LOESS 漂移校正
 qc_rsd_cut     = 0.30,           # QC RSD ≤ 30% 保留
 diff_method    = "limma",        # 差异分析：limma（两组更稳）
ml_method      = "rf",           # 机器学习：随机森林
cor_method     = "spearman",     # 网络相关：斯皮尔曼
 cor_threshold  = 0.6,
p_threshold    = 0.05,
weights = list(
   abundance   = 0.3,   # 偏好高丰度与高流行率
  importance  = 0.3,   # ML 重要性
  differential= 0.2,   # 差异显著性与效应量
  network     = 0.2    # 网络中心性
 ),
 nfolds = 5,
ntree  = 300           # RF 森林数（示例里稍微降点速度更快）
)
}
}
\description{
Untargeted Metabolomics Feature Selection (MS)
}
\author{
Tao Wen \email{2018203048@njau.edu.cn},
Peng-Hao Xie \email{2019103106@njau.edu.cn}
}
